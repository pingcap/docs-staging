---
title: TiDB Cluster Troubleshooting Guide
summary: TiDB を使用する際に問題を診断して解決する方法を学びます。
---

# TiDBクラスタシューティング ガイド {#tidb-cluster-troubleshooting-guide}

このガイドは、TiDB の使用中に発生する基本的な問題の診断と解決に役立ちます。問題が解決しない場合は、次の情報を収集して、 [バグを報告](/support.md)を実行してください。

-   正確なエラーメッセージとエラー発生時の操作
-   すべてのコンポーネントの状態
-   エラーを報告するコンポーネントのログ内の`error` `fatal` `panic`
-   構成と展開トポロジ
-   `dmesg`のTiDBコンポーネント関連の問題

その他の情報については[よくある質問 (FAQ)](/faq/tidb-faq.md)参照してください。

## データベースに接続できません {#cannot-connect-to-the-database}

1.  `tidb-server` `tikv-server`含むすべてのサービスが開始されている`pd-server`を確認します。

2.  `ps`コマンドを使用して、すべてのプロセスが実行されているかどうかを確認します。

    -   特定のプロセスが実行されていない場合は、次の対応するセクションを参照して問題を診断し、解決してください。

    <!---->

    -   すべてのプロセスが実行中の場合は、 `tidb-server`ログをチェックして、次のメッセージが表示されているかどうかを確認します。
        -   情報スキーマが古くなっています: `tikv-server`に接続できない場合、このメッセージが表示されます。 `pd-server`と`tikv-server`の状態とログを確認してください。
        -   panic: プログラムに問題がある場合、このメッセージが表示されます。詳細なpanicログを提供してください[バグを報告](/support.md) 。

3.  データがクリアされ、サービスが再デプロイされる場合は、次の点を確認してください。

    -   `tikv-server`と`pd-server`のデータはすべてクリアされます。特定のデータは`tikv-server`に保存され、メタデータは`pd-server`に保存されます。2 つのサーバーのうち 1 つだけがクリアされると、データの不整合が発生します。
    -   `pd-server`と`tikv-server`のデータがクリアされ、 `pd-server`と`tikv-server`が再起動されたら、 `tidb-server`も再起動する必要があります。クラスター ID は、 `pd-server`が初期化されるときにランダムに割り当てられます。そのため、クラスターが再デプロイされると、クラスター ID が変更され、新しいクラスター ID を取得するには`tidb-server`を再起動する必要があります。

## <code>tidb-server</code>を起動できません {#cannot-start-code-tidb-server-code}

`tidb-server`起動できない場合の状況については、以下を参照してください。

-   起動パラメータにエラーがあります。

    [TiDB の構成とオプション](/command-line-flags-for-tidb-configuration.md)参照してください。

-   港は占領されています。

    `lsof -i:port`コマンドを使用して、特定のポートに関連するすべてのネットワークを表示し、 `tidb-server`を開始するポートが使用されていないことを確認します。

<!---->

-   `pd-server`に接続できません。

    -   TiDB と PD 間のネットワークがスムーズに動作しているかどうか、ネットワークに ping できるかどうか、ファイアウォールの設定に問題があるかどうかなどを確認します。
    -   ネットワークに問題がない場合は、 `pd-server`プロセスの状態とログを確認します。

## <code>tikv-server</code>起動できません {#cannot-start-code-tikv-server-code}

`tikv-server`起動できない場合の状況については、以下を参照してください。

-   起動パラメータにエラーがあります: [TiKV の設定とオプション](/command-line-flags-for-tikv-configuration.md)参照してください。

-   ポートが使用中です: `lsof -i:port`コマンドを使用して、特定のポートに関連するすべてのネットワークを表示し、 `tikv-server`を開始するポートが使用されていないことを確認します。

<!---->

-   `pd-server`に接続できません。

    -   TiDB と PD 間のネットワークがスムーズに動作しているかどうか、ネットワークに ping できるかどうか、ファイアウォールの設定に問題があるかどうかなどを確認します。

    -   ネットワークに問題がない場合は、 `pd-server`プロセスの状態とログを確認します。

<!---->

-   ファイルは使用中です。

    1 つのデータベース ファイル ディレクトリで 2 つの TiKV ファイルを開かないでください。

## <code>pd-server</code>起動できません {#cannot-start-code-pd-server-code}

`pd-server`起動できない場合の状況については、以下を参照してください。

-   起動パラメータにエラーがあります。

    [PD 構成とオプション](/command-line-flags-for-pd-configuration.md)参照してください。

-   港は占領されています。

    `lsof -i:port`コマンドを使用して、特定のポートに関連するすべてのネットワークを表示し、 `pd-server`を開始するポートが使用されていないことを確認します。

## TiDB/TiKV/PD プロセスが予期せず中止される {#the-tidb-tikv-pd-process-aborts-unexpectedly}

-   プロセスはフォアグラウンドで開始されていますか? クライアントが中止したためにプロセスが終了する可能性があります。

-   `nohup+&`コマンドラインで実行されていますか? この場合、hup シグナルを受信するため、プロセスが中止される可能性があります。 起動コマンドをスクリプトに記述して実行することをお勧めします。

## TiDBpanic {#tidb-panic}

panicログを提供してください[バグを報告](/support.md)できます。

## 接続が拒否されました {#the-connection-is-rejected}

オペレーティング システムのネットワーク パラメータが正しいことを確認します。これには以下が含まれますが、これらに限定されません。

-   接続文字列内のポートは、開始ポート`tidb-server`と一致します。
-   ファイアウォールは正しく構成されています。

## 開いているファイルが多すぎる {#open-too-many-files}

プロセスを開始する前に、 `ulimit -n`の結果が十分に大きいことを確認してください。値を`unlimited`または`1000000`より大きく設定することをお勧めします。

## データベースアクセスがタイムアウトし、システム負荷が高すぎる {#database-access-times-out-and-the-system-load-is-too-high}

まず、 [スロークエリログ](/identify-slow-queries.md)チェックして、不適切な SQL ステートメントが原因かどうかを確認します。

問題を解決できなかった場合は、次の情報を提供してください。

-   展開トポロジ

    -   `tidb-server` / `pd-server` / `tikv-server`インスタンスはいくつデプロイされていますか?
    -   これらのインスタンスはマシン内でどのように分散されるのでしょうか?

-   これらのインスタンスがデプロイされているマシンのハードウェア構成:

    -   CPUコアの数
    -   メモリのサイズ
    -   ディスクの種類（SSD またはハード ドライブ ディスク）
    -   それらは物理マシンですか、それとも仮想マシンですか?

<!---->

-   TiDB クラスター以外のサービスはありますか?
-   `pd-server`と`tikv-server`は別々に展開されますか?
-   現在の操作は何ですか?
-   `top -H`コマンドを使用して CPU スレッド名を確認します。
-   最近、ネットワークまたは IO 監視データに例外はありますか?
