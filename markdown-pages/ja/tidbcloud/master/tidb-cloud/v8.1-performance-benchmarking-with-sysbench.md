---
title: TiDB Cloud Sysbench Performance Test Report for TiDB v8.1.0
summary: TiDB バージョン v8.1.0 を使用した TiDB 専用クラスターの Sysbench パフォーマンス テスト結果を紹介します。
---

# TiDB v8.1.0 のTiDB Cloud Sysbench パフォーマンス テスト レポート {#tidb-cloud-sysbench-performance-test-report-for-tidb-v8-1-0}

このドキュメントでは、TiDB バージョン v8.1.0 を使用した TiDB 専用クラスターの Sysbench パフォーマンス テストの手順と結果について説明します。このレポートは、TiDB セルフホスト v8.1.0 クラスターのパフォーマンスのリファレンスとしても使用できます。

## テストの概要 {#test-overview}

このテストは、オンライン トランザクション処理 (OLTP) シナリオにおける TiDB v8.1.0 の Sysbench パフォーマンスを示すことを目的としています。

## テスト環境 {#test-environment}

### TiDB クラスター {#tidb-cluster}

テストは、次の設定で TiDB クラスター上で実行されます。

-   クラスタタイプ: [TiDB専用](/tidb-cloud/select-cluster-tier.md#tidb-dedicated)
-   クラスタバージョン: v8.1.0
-   クラウドプロバイダー: AWS (us-west-2)
-   クラスタ構成:

    | ノードタイプ | ノードサイズ         | ノード数 | ノードstorage |
    | :----- | :------------- | :--- | :--------- |
    | ティビ    | 16 vCPU、32 GiB | 2    | 該当なし       |
    | ティクヴ   | 16 vCPU、64 GiB | 3    | 1000ギガバイト  |

### パラメータ設定 {#parameter-configuration}

システム変数[`tidb_session_plan_cache_size`](https://docs.pingcap.com/tidb/stable/system-variables#tidb_session_plan_cache_size-new-in-v710)キャッシュできるプランの最大数を制御します。デフォルト値は`100`です。このドキュメントでは、ワークロードごとに`tidb_session_plan_cache_size`を`1000`に設定してテストを実施します。

```sql
SET GLOBAL tidb_session_plan_cache_size = 1000;
```

> **注記：**
>
> TiDB Cloudの場合、クラスターの TiKV パラメータを変更するには、 [PingCAP サポート](/tidb-cloud/tidb-cloud-support.md)に問い合わせてサポートを受けることができます。

TiKV パラメータ[`prefill-for-recycle`](https://docs.pingcap.com/tidb/stable/tikv-configuration-file#prefill-for-recycle-new-in-v700)を使用すると、初期化後すぐにログのリサイクルを有効にすることができます。このドキュメントでは、次の`prefill-for-recycle`の構成を使用して、さまざまなワークロードに基づいてテストを実施します。

-   `oltp_point_select`ワークロードの場合、 [`prefill-for-recycle`](https://docs.pingcap.com/tidb/stable/tikv-configuration-file#prefill-for-recycle-new-in-v700)パラメータのデフォルト値を使用します。

    ```yaml
    raft-engine.prefill-for-recycle = false
    ```

-   `oltp_insert` `oltp_read_write`および`oltp_update_non_index`ワーク`oltp_update_index`の場合は、 [`prefill-for-recycle`](https://docs.pingcap.com/tidb/stable/tikv-configuration-file#prefill-for-recycle-new-in-v700)パラメータを有効にします。

    ```yaml
    raft-engine.prefill-for-recycle = true
    ```

### ベンチマーク実行者 {#benchmark-executor}

ベンチマーク エグゼキュータは、TiDB クラスタに SQL クエリを送信します。このテストでは、ハードウェア構成は次のとおりです。

-   マシンタイプ: Amazon EC2 (us-west-2)
-   インスタンスタイプ: c6a.2xlarge
-   Sysbench バージョン: sysbench 1.0.20 (バンドルされた LuaJIT 2.1.0-beta2 を使用)

## テスト手順 {#test-steps}

このセクションでは、Sysbench パフォーマンス テストを段階的に実行する方法を紹介します。

1.  [TiDB Cloudコンソール](https://tidbcloud.com/)では、 [テスト環境](#tidb-cluster)要件を満たす TiDB 専用クラスターを作成します。

    詳細については[TiDB専用クラスターを作成する](/tidb-cloud/create-tidb-cluster.md)参照してください。

2.  ベンチマーク エグゼキュータで、新しく作成されたクラスターに接続し、 `sbtest`という名前のデータベースを作成します。

    クラスターに接続するには、 [プライベートエンドポイント経由で TiDB Dedicated に接続する](/tidb-cloud/set-up-private-endpoint-connections.md)参照してください。

    `sbtest`データベースを作成するには、次の SQL ステートメントを実行します。

    ```sql
    CREATE DATABASE sbtest;
    ```

3.  Sysbench データを`sbtest`データベースにロードします。

    1.  このドキュメントのテストは[システムベンチ](https://github.com/akopytov/sysbench)に基づいて実装されています。sysbench をインストールするには[ソースからのビルドとインストール](https://github.com/akopytov/sysbench#building-and-installing-from-source)を参照してください。

    2.  次の`sysbench prepare`コマンドを実行して`${PASSWORD}` `${PORT}` `sbtest` `${THREAD}` `${HOST}`置き換えます。

    ```shell
    sysbench oltp_common \
       --threads=${THREAD} \
       --db-driver=mysql \
       --mysql-db=sbtest \
       --mysql-host=${HOST} \
       --mysql-port=${PORT} \
       --mysql-user=root \
       --mysql-password=${PASSWORD} \
       prepare --tables=32 --table-size=10000000
    ```

4.  さまざまなワークロードで Sysbench パフォーマンス テストを実行するには、次の`sysbench run`コマンドを実行します。このドキュメントでは、 `oltp_point_select` 、 `oltp_read_write` 、 `oltp_update_non_index` 、 `oltp_update_index` 、および`oltp_insert`の 5 つのワークロードでテストを実行します。各ワークロードについて、このドキュメントでは`${THREAD}`変数の異なる値を使用して 3 つのテストを実行します。 `oltp_point_select`と`oltp_read_write`の場合、値は`50` 、 `100` 、および`200`です。その他のワークロードの場合、値は`100` 、 `200` 、および`400`です。同時実行ごとに、テストには 20 分かかります。

    ```shell
    sysbench ${WORKLOAD} run \
      --mysql-host=${HOST} \
      --mysql-port=${PORT} \
      --mysql-user=root \
      --db-driver=mysql \
      --mysql-db=sbtest \
      --threads=${THREAD} \
      --time=1200 \
      --report-interval=10 \
      --tables=32 \
      --table-size=10000000 \
      --mysql-ignore-errors=1062,2013,8028,9007 \
      --auto-inc=false \
      --mysql-password=${PASSWORD}
    ```

## 試験結果 {#test-results}

このセクションでは、 [テスト環境](#test-environment)における v8.1.0 の Sysbench パフォーマンスを紹介します。

### ポイントセレクトパフォーマンス {#point-select-performance}

`oltp_point_select`ワークロードのパフォーマンスは次のとおりです。

| スレッド | TPPSについて | 95%レイテンシー(ミリ秒) |
| :--- | :------- | :------------- |
| 50   | 32,741   | 1.96           |
| 100  | 62,545   | 2.03           |
| 200  | 111,470  | 2.48           |

![Sysbench point select performance](https://download.pingcap.com/images/docs/tidb-cloud/v8.1.0_oltp_point_select.png)

### 読み取り書き込みパフォーマンス {#read-write-performance}

`oltp_read_write`ワークロードのパフォーマンスは次のとおりです。

| スレッド | TPPSについて | 95%レイテンシー(ミリ秒) |
| :--- | :------- | :------------- |
| 50   | 1,232    | 46.6           |
| 100  | 2,341    | 51             |
| 200  | 3,240    | 109            |

![Sysbench read write performance](https://download.pingcap.com/images/docs/tidb-cloud/v8.1.0_oltp_read_write.png)

### 非インデックスパフォーマンスの更新 {#update-non-index-performance}

`oltp_update_non_index`ワークロードのパフォーマンスは次のとおりです。

| スレッド | TPPSについて | 95%レイテンシー(ミリ秒) |
| :--- | :------- | :------------- |
| 100  | 14,000   | 9.39           |
| 200  | 25,215   | 10.5           |
| 400  | 42,550   | 12.8           |

![Sysbench update non-index performance](https://download.pingcap.com/images/docs/tidb-cloud/v8.1.0_oltp_update_non_index.png)

### インデックスのパフォーマンスを更新する {#update-index-performance}

`oltp_update_index`ワークロードのパフォーマンスは次のとおりです。

| スレッド | TPPSについて | 95%レイテンシー(ミリ秒) |
| :--- | :------- | :------------- |
| 100  | 11,188   | 11.7           |
| 200  | 17,805   | 14.7           |
| 400  | 24,575   | 23.5           |

![Sysbench update index performance](https://download.pingcap.com/images/docs/tidb-cloud/v8.1.0_oltp_update_index.png)

### 挿入パフォーマンス {#insert-performance}

`oltp_insert`ワークロードのパフォーマンスは次のとおりです。

| スレッド | TPPSについて | 95%レイテンシー(ミリ秒) |
| :--- | :------- | :------------- |
| 100  | 18,339   | 7.3            |
| 200  | 29,387   | 9.73           |
| 400  | 42,712   | 14.2           |

![Sysbench insert performance](https://download.pingcap.com/images/docs/tidb-cloud/v8.1.0_oltp_insert.png)
