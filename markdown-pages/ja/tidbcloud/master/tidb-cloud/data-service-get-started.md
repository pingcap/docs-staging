---
title: Get Started with Data Service
summary: TiDB Cloudデータ サービスを使用して HTTPS リクエストでデータにアクセスする方法を学習します。
---

# データサービスを始める {#get-started-with-data-service}

データ サービス (ベータ版) を使用すると、カスタム API エンドポイントを使用して HTTPS リクエスト経由でTiDB Cloudデータにアクセスし、HTTPS と互換性のある任意のアプリケーションまたはサービスとシームレスに統合できます。

> **ヒント：**
>
> TiDB Cloud は、 TiDB クラスター用の Chat2Query API を提供します。有効にすると、 TiDB Cloud は**Chat2Query**と呼ばれるシステム データ アプリと、データ サービス内の Chat2Data エンドポイントを自動的に作成します。このエンドポイントを呼び出して、指示を与えることで AI が SQL ステートメントを生成して実行できるようにすることができます。
>
> 詳細については[Chat2Query APIを使い始める](/tidb-cloud/use-chat2query-api.md)参照してください。

このドキュメントでは、データ アプリを作成し、エンドポイントを開発、テスト、デプロイ、および呼び出すことで、TiDB Cloud Data Service (ベータ版) をすぐに使い始める方法を紹介します。データ アプリは、特定のアプリケーションのデータにアクセスするために使用できるエンドポイントのコレクションです。

## あなたが始める前に {#before-you-begin}

データ アプリを作成する前に、クラスター[TiDB サーバーレス](/tidb-cloud/select-cluster-tier.md#tidb-serverless)を作成していることを確認してください。クラスターがない場合は、 [TiDB サーバーレス クラスターを作成する](/tidb-cloud/create-tidb-cluster-serverless.md)の手順に従って作成してください。

## サンプルデータアプリを使い始める {#get-started-with-a-sample-data-app}

サンプル データ アプリを作成することは、データ サービスの使用を開始するのに最適な方法です。プロジェクトにまだデータ アプリがない場合は、**データ サービス**ページの画面上の指示に従ってサンプル データ アプリを作成し、このアプリを使用してデータ サービスの機能を調べることができます。

1.  [TiDB Cloudコンソール](https://tidbcloud.com)で、<mdsvgicon name="icon-left-data-service">左側のナビゲーション ペインにある**データ サービス**。</mdsvgicon>

2.  **データ サービス**ページで、**サンプル データ アプリの作成を**クリックします。ダイアログが表示されます。

3.  ダイアログで、必要に応じてアプリ名を更新し、データ アプリがアクセスするクラスターを選択して、 **[作成] を**クリックします。

    作成プロセスには数秒かかります。

    > **注記：**
    >
    > 現在のプロジェクトにクラスターがない場合、 **「データ ソースのリンク」**ドロップダウン リストで**「新しいクラスタの作成」を**クリックして、最初にクラスターを作成できます。

4.  サンプル データ アプリが自動的に作成されると、左側のペインにアプリ名、エンドポイントのリスト、中央のペインにエンドポイントの SQL ステートメント、右側にサンプル データ アプリの使用方法の説明が表示されます。

5.  右側の指示に従ってエンドポイントを選択し、curl コマンドを使用してエンドポイントを呼び出します。

## 独自のデータアプリを使い始める {#get-started-with-your-own-data-app}

Data Service の使用を開始するには、独自のデータ アプリを作成し、次の手順に従ってエンドポイントを開発、テスト、デプロイ、および呼び出すこともできます。

### ステップ1. データアプリを作成する {#step-1-create-a-data-app}

データ アプリを作成するには、次の手順を実行します。

1.  [TiDB Cloudコンソール](https://tidbcloud.com)で、<mdsvgicon name="icon-left-data-service">左側のナビゲーション ペインにある**データ サービス**。</mdsvgicon>

2.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページで、<mdsvgicon name="icon-create-data-app">左側のペインで**DataApp を作成します**。</mdsvgicon>

    > **ヒント：**
    >
    > これがプロジェクトの最初のデータ アプリである場合は、ページの中央にある**[データ アプリの作成] を**クリックします。

3.  **[データ アプリの作成]**ダイアログで、名前と説明を入力し、データ アプリがアクセスするクラスターを選択します。

    > **注記：**
    >
    > デフォルトでは、データ アプリの種類は**標準データ アプリ**です。Chat2Query**データ アプリ**を作成する場合は、このドキュメントではなく[Chat2Query APIを使い始める](/tidb-cloud/use-chat2query-api.md)を参照してください。

4.  (オプション) データ アプリのエンドポイントを優先 GitHub リポジトリとブランチに自動的にデプロイするには、 **GitHub に接続**を有効にして、次の操作を行います。

    1.  **「GitHub にインストール」を**クリックし、画面の指示に従って、 **TiDB Cloud Data Service**をアプリケーションとしてターゲット リポジトリにインストールします。

    2.  **「承認」**をクリックして、GitHub 上のアプリケーションへのアクセスを承認します。

    3.  データ アプリの構成ファイルを保存するターゲット リポジトリ、ブランチ、およびディレクトリを指定します。

    > **注記：**
    >
    > -   ディレクトリはスラッシュ ( `/` ) で始まる必要があります。たとえば、 `/mydata` 。指定したディレクトリがターゲット リポジトリとブランチに存在しない場合は、自動的に作成されます。
    > -   リポジトリ、ブランチ、ディレクトリの組み合わせによって構成ファイルのパスが識別されます。このパスはデータ アプリ間で一意である必要があります。指定したパスが別のデータ アプリで既に使用されている場合は、代わりに新しいパスを指定する必要があります。そうしないと、現在のデータ アプリのTiDB Cloudコンソールで構成されたエンドポイントによって、指定したパスのファイルが上書きされます。

5.  **「データアプリの作成」を**クリックします。3 [**データサービス**](https://tidbcloud.com/console/data-service)詳細ページが表示されます。

6.  データ アプリを GitHub に接続するように構成している場合は、指定した GitHub ディレクトリを確認してください。 [データアプリ構成ファイル](/tidb-cloud/data-service-app-config-files.md)が`tidb-cloud-data-service`によってディレクトリにコミットされていることがわかります。これは、データ アプリが GitHub に正常に接続されていることを意味します。

    新しいデータ アプリでは、**自動同期とデプロイメント**および**ドラフトの確認が**デフォルトで有効になっているため、 TiDB Cloudコンソールと GitHub 間でデータ アプリの変更を簡単に同期し、デプロイメント前に変更を確認できます。GitHub 統合の詳細については、 [データアプリの変更を GitHub で自動的にデプロイ](/tidb-cloud/data-service-manage-github-connection.md)を参照してください。

### ステップ2. エンドポイントを開発する {#step-2-develop-an-endpoint}

エンドポイントは、SQL ステートメントを実行するためにカスタマイズできる Web API です。

データ アプリを作成すると、デフォルトの`untitled endpoint`自動的に作成されます。デフォルトのエンドポイントを使用して、 TiDB Cloudクラスターにアクセスできます。

新しいエンドポイントを作成する場合は、新しく作成したデータ アプリを見つけて、アプリ名の右側にある [ **+****エンドポイントの作成]**をクリックします。

#### プロパティを構成する {#configure-properties}

右側のペインで、 **[プロパティ]**タブをクリックし、エンドポイントのプロパティを次のように設定します。

-   **パス**: ユーザーがエンドポイントにアクセスするために使用するパス。リクエスト メソッドとパスの組み合わせは、データ アプリ内で一意である必要があります。

-   **エンドポイント URL** : (読み取り専用) URL は、対応するクラスタが配置されているリージョン、データ アプリのサービス URL、およびエンドポイントのパスに基づいて自動的に生成されます。たとえば、エンドポイントのパスが`/my_endpoint/get_id`の場合、エンドポイント URL は`https://<region>.data.tidbcloud.com/api/v1beta/app/<App ID>/endpoint/my_endpoint/get_id`になります。

-   **リクエスト メソッド**: エンドポイントの HTTP メソッド`GET`を使用してデータを取得し、 `POST`を使用してデータを作成または挿入し、 `PUT`を使用してデータを更新または変更し、 `DELETE`を使用してデータを削除します。

エンドポイント プロパティの詳細については、 [プロパティを構成する](/tidb-cloud/data-service-manage-endpoint.md#configure-properties)参照してください。

#### SQL文を書く {#write-sql-statements}

**データ サービス**ページの中央のペインにある SQL エディターで、エンドポイントの SQL ステートメントをカスタマイズできます。

1.  クラスターを選択します。

    > **注記：**
    >
    > ドロップダウン リストには、データ アプリにリンクされているクラスターのみが表示されます。リンクされたクラスターを管理するには、 [リンクされたクラスターを管理する](/tidb-cloud/data-service-manage-data-app.md#manage-linked-data-sources)参照してください。

    SQL エディターの上部にあるドロップダウン リストから、SQL ステートメントを実行するクラスターを選択します。すると、右側のペインの**[スキーマ]**タブに、このクラスターのすべてのデータベースが表示されます。

2.  SQL ステートメントを記述します。

    データをクエリまたは変更する前に、まず SQL ステートメントでデータベースを指定する必要があります。たとえば、 `USE database_name;` 。

    SQL エディターでは、テーブル結合クエリ、複雑なクエリ、集計関数などのステートメントを記述できます。また、単に`--`と入力して指示を入力するだけで、AI が SQL ステートメントを自動的に生成することもできます。

    パラメータを定義するには、SQL ステートメントに`${ID}`ような変数プレースホルダーとして挿入します。たとえば、 `SELECT * FROM table_name WHERE id = ${ID}` 。次に、右側のペインの**[Params]**タブをクリックして、パラメータ定義を変更し、値をテストします。

    > **注記：**
    >
    > -   パラメータ名では大文字と小文字が区別されます。
    > -   パラメータはテーブル名または列名として使用できません。

    -   **定義**セクションでは、クライアントがエンドポイントを呼び出すときにパラメーターが必須かどうか、パラメーターのデータ型、およびデフォルト値を指定できます。
    -   **テスト値**セクションでは、パラメータのテスト値を設定できます。テスト値は、SQL ステートメントを実行するとき、またはエンドポイントをテストするときに使用されます。テスト値を設定しない場合は、デフォルト値が使用されます。
    -   詳細については[パラメータを設定する](/tidb-cloud/data-service-manage-endpoint.md#configure-parameters)参照してください。

3.  SQL ステートメントを実行します。

    SQL ステートメントにパラメータを挿入した場合は、右側のペインの**[Params]**タブでパラメータのテスト値またはデフォルト値が設定されていることを確認してください。設定されていない場合は、エラーが返されます。

    SQL ステートメントを実行するには、カーソルで SQL の行を選択し、 **[実行]** &gt; **[カーソル位置で実行]**をクリックします。

    SQL エディターですべての SQL ステートメントを実行するには、 **[実行] を**クリックします。この場合、最後の SQL 結果のみが返されます。

    ステートメントを実行すると、ページの下部にある**[結果]**タブにクエリ結果がすぐに表示されます。

### ステップ 3. エンドポイントをテストする (オプション) {#step-3-test-the-endpoint-optional}

エンドポイントを構成した後、デプロイする前にエンドポイントをテストして、期待どおりに動作するかどうかを確認できます。

エンドポイントをテストするには、右上隅の**[テスト] を**クリックするか、 **F5**キーを押します。

その後、ページ下部の**「HTTP レスポンス」**タブでレスポンスを確認できます。レスポンスの詳細については、 [エンドポイントの応答](/tidb-cloud/data-service-manage-endpoint.md#response)を参照してください。

### ステップ4.エンドポイントをデプロイ {#step-4-deploy-the-endpoint}

エンドポイントをデプロイするには、次の手順を実行します。

1.  エンドポイントの詳細ページで、右上隅の**[デプロイ] を**クリックします。

2.  デプロイを確認するには、 **[デプロイ]**をクリックします。エンドポイントが正常にデプロイされると、[エンドポイント**がデプロイされました] という**プロンプトが表示されます。

    エンドポイントの詳細ページの右側のペインで、 **[デプロイメント]**タブをクリックすると、デプロイされた履歴を表示できます。

### ステップ5.エンドポイントを呼び出す {#step-5-call-the-endpoint}

HTTPS リクエストを送信することでエンドポイントを呼び出すことができます。エンドポイントを呼び出す前に、まずデータ アプリの API キーを取得する必要があります。

#### 1. APIキーを作成する {#1-create-an-api-key}

1.  [**データサービス**](https://tidbcloud.com/console/data-service)ページの左側のペインで、データ アプリの名前をクリックして詳細を表示します。

2.  **認証**領域で、 **「API キーの作成」を**クリックします。

3.  **[API キーの作成]**ダイアログ ボックスで、次の操作を行います。

    1.  (オプション) API キーの説明を入力します。

    2.  API キーのロールを選択します。

        このロールは、API キーがデータ アプリにリンクされたクラスターにデータを読み書きできるかどうかを制御するために使用されます。1 または`ReadOnly` `ReadAndWrite`ロールを選択できます。

        -   `ReadOnly` : API キーは`SELECT` 、 `SHOW` 、 `USE` 、 `DESC` 、 `EXPLAIN`ステートメントなどのデータのみを読み取ることができます。
        -   `ReadAndWrite` : API キーによるデータの読み取りと書き込みを許可します。この API キーを使用して、DML ステートメントや DDL ステートメントなどのすべての SQL ステートメントを実行できます。

    3.  (オプション) API キーに必要なレート制限を設定します。

4.  **「次へ」**をクリックします。公開鍵と秘密鍵が表示されます。

    秘密鍵をコピーして安全な場所に保存したことを確認してください。このページを離れると、完全な秘密鍵を再度取得できなくなります。

5.  **「完了」を**クリックします。

API キーの詳細については、 [データサービスの API キー](/tidb-cloud/data-service-api-key.md)参照してください。

#### 2. コード例を取得する {#2-get-the-code-example}

TiDB Cloud は、エンドポイントの呼び出しに役立つコード例を生成します。コード例を取得するには、次の手順を実行します。

1.  [**データサービス**](https://tidbcloud.com/console/data-service)ページの左側のペインで、エンドポイントの名前をクリックし、右上隅の**[...]** &gt; **[コード例]**をクリックします。 **[コード例]**ダイアログ ボックスが表示されます。

2.  ダイアログ ボックスで、エンドポイントを呼び出すために使用するクラスターとデータベースを選択し、コード例をコピーします。

    curl コードの例は次のとおりです。

    <SimpleTab>
     <div label="Test Environment">

    エンドポイントのドラフト バージョンを呼び出すには、 `endpoint-type: draft`ヘッダーを追加する必要があります。

    ```bash
    curl --digest --user '<Public Key>:<Private Key>' \
      --request GET 'https://<region>.data.tidbcloud.com/api/v1beta/app/<App ID>/endpoint/<Endpoint Path>' \
      --header 'endpoint-type: draft'
    ```

    </div>

    <div label="Online Environment">

    オンライン環境でコード例を確認する前に、まずエンドポイントをデプロイする必要があります。

    エンドポイントの現在のオンライン バージョンを呼び出すには、次のコマンドを使用します。

    ```bash
    curl --digest --user '<Public Key>:<Private Key>' \
      --request GET 'https://<region>.data.tidbcloud.com/api/v1beta/app/<App ID>/endpoint/<Endpoint Path>'
    ```

    </div>
     </SimpleTab>

    > **注記：**
    >
    > -   リージョンドメイン`<region>.data.tidbcloud.com`を要求すると、TiDB クラスターが配置されているリージョンのエンドポイントに直接アクセスできます。
    > -   あるいは、リージョンを指定せずにグローバル ドメイン`data.tidbcloud.com`を要求することもできます。この方法では、 TiDB Cloud は内部的に要求をターゲット リージョンにリダイレクトしますが、これにより追加のレイテンシーが発生する可能性があります。この方法を選択する場合は、エンドポイントを呼び出すときに、curl コマンドに`--location-trusted`オプションを追加するようにしてください。

#### 3. コード例を使用する {#3-use-the-code-example}

コード例をアプリケーションに貼り付けて実行します。すると、エンドポイントの応答を取得できます。

-   プレースホルダー`<Public Key>`と`<Private Key>`を API キーに置き換える必要があります。
-   エンドポイントにパラメータが含まれている場合は、エンドポイントを呼び出すときにパラメータ値を指定します。

エンドポイントを呼び出すと、JSON 形式で応答が表示されます。次に例を示します。

```json
{
  "type": "sql_endpoint",
  "data": {
    "columns": [
      {
        "col": "id",
        "data_type": "BIGINT",
        "nullable": false
      },
      {
        "col": "type",
        "data_type": "VARCHAR",
        "nullable": false
      }
    ],
    "rows": [
      {
        "id": "20008295419",
        "type": "CreateEvent"
      }
    ],
    "result": {
      "code": 200,
      "message": "Query OK!",
      "start_ms": 1678965476709,
      "end_ms": 1678965476839,
      "latency": "130ms",
      "row_count": 1,
      "row_affect": 0,
      "limit": 50
    }
  }
}
```

回答の詳細については[エンドポイントの応答](/tidb-cloud/data-service-manage-endpoint.md#response)参照してください。

## もっと詳しく知る {#learn-more}

-   [データサービスの概要](/tidb-cloud/data-service-overview.md)
-   [Chat2Query APIを使い始める](/tidb-cloud/use-chat2query-api.md)
-   [データアプリを管理する](/tidb-cloud/data-service-manage-data-app.md)
-   [エンドポイントの管理](/tidb-cloud/data-service-manage-endpoint.md)
